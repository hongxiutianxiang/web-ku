<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>030-Ajax4</title>
</head>
<body>
	<!--发送基本ajax请求-封装-->
	<button id="btn">测试</button>
</body>
<script>
	function ajax(method,url,data,fnSucc,fnFailed){
		//1.生成Ajax对象
		var oAjax = new XMLHttpRequest();

		if(method.toUpperCase() == 'POST'){
			//2.建立连接
			oAjax.open(method,url,true);		
			//可选，设置请求头
			oAjax.setRequestHeader('Content-type','application/x-www-form-urlencoded');
			oAjax.send(data);
		}else if(method.toUpperCase() == 'GET'){
			if(data){
				url = url + '?'+data;
			}
			//2.建立连接
			oAjax.open(method,url,true);
			//3.建立连接		
			oAjax.send();
		}	
		//4.监听事件接收数据
		oAjax.onreadystatechange = function(){
			//console.log(oAjax.readyState);//2 3 4
			if(oAjax.readyState == 4){
				if(oAjax.status == 200){
					//console.log(oAjax.responseText);
					try{
						var obj = JSON.parse(oAjax.responseText);
						typeof fnSucc == 'function' && fnSucc(obj);
					}catch(e){
						console.log(e);	
					}	
				}else{
					typeof fnFailed == 'function' && fnFailed(oAjax.status);
				}
			}
		}
	}
	var oBtn = document.getElementById('btn');
	oBtn.onclick = function(){
		/*
		ajax(
				'POST',
				'http://127.0.0.1:3000/getData?name=Tom',
				'{"name":"Tom","age":200}',
				function(obj){
					console.log(obj);
				},
				function(status){
					console.log(status);
				}
			);
		*/	
		ajax(
				'get',
				'http://127.0.0.1:3000/031-data.json',
				'',
				function(arr){
					var oUl = document.createElement('ul');
					for(var i = 0;i<arr.length;i++){
						var aLi = document.createElement('li');
						aLi.innerHTML = '姓名：'+arr[i].name+'年龄：'+arr[i].age;
						oUl.appendChild(aLi);
					}

					document.body.appendChild(oUl);
				},
				function(status){
					console.log(status);
				}
			);
	}
	
</script>
</html>